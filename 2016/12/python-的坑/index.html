<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.62.2 with theme Tranquilpeak 0.4.7-BETA">
<meta name="author" content="vici">
<meta name="keywords" content=", vici, blog, heyuhua.com, 何育华, v1c77">
<meta name="description" content="生死怎能看淡, 不服就是要干">


<meta property="og:description" content="生死怎能看淡, 不服就是要干">
<meta property="og:type" content="article">
<meta property="og:title" content="python 的坑 ">
<meta name="twitter:title" content="python 的坑 ">
<meta property="og:url" content="http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
<meta property="twitter:url" content="http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
<meta property="og:site_name" content="vici&#39;blog">
<meta property="og:description" content="生死怎能看淡, 不服就是要干">
<meta name="twitter:description" content="生死怎能看淡, 不服就是要干">
<meta property="og:locale" content="zh-cn">

  
    <meta property="article:published_time" content="2016-12-15T16:17:05">
  
  
    <meta property="article:modified_time" content="2016-12-15T16:17:05">
  
  
  
  
    
      <meta property="article:tag" content="python">
    
  


<meta name="twitter:card" content="summary">

  <meta name="twitter:site" content="@bookerHe">


  <meta name="twitter:creator" content="@bookerHe">










  <meta property="og:image" content="https://www.gravatar.com/avatar/85d1ea47d48692ca0ade206fa656bd14?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/85d1ea47d48692ca0ade206fa656bd14?s=640">


    <title>python 的坑 </title>

    <link rel="icon" href="//qiniu.heyuhua.com/blog_favicon.ico">
    

    

    <link rel="canonical" href="http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="http://blog.heyuhua.com/css/style-twzjdbqhmnnacqs0pwwdzcdbt8yhv8giawvjqjmyfoqnvazl0dalmnhdkvp7.min.css" />
    
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-88015219-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="5">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="http://blog.heyuhua.com/">vici&#39;blog</a>
  </div>
  
    
      <a class="header-right-icon st-search-show-outputs"
         href="http://blog.heyuhua.com/#search">
    
    
      <i class="fa fa-lg fa-search"></i>
    
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="5">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="http://blog.heyuhua.com/#about">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/85d1ea47d48692ca0ade206fa656bd14?s=110" alt="作者的图片" />
        </a>
        <h4 class="sidebar-profile-name">vici</h4>
        
          <h5 class="sidebar-profile-bio">极度选择困难. <strong>懒癌晚期</strong></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://blog.heyuhua.com/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">首页</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://blog.heyuhua.com/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">分类</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://blog.heyuhua.com/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">标签</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://blog.heyuhua.com/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">归档</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://blog.heyuhua.com/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">关于</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/v1c77" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://stackoverflow.com/users/6382035/vi-ci" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
      
      <span class="sidebar-button-desc">Stack Overflow</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://blog.heyuhua.com/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="5"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      python 的坑 
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2016-12-15T16:17:05Z">
        
  十二月 15, 2016

      </time>
    
    
  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>生死怎能看淡, 不服就是要干</p>
<h2 id="一-亲身经历">一. 亲身经历</h2>
<blockquote>
<p>python 是我第一个拿出10分认真的态度去学习的语言.</p>
</blockquote>
<p>但是可能需要12分的认真。因为周围毕竟还有一些十分认真的人在尝试着用她解决问题。之前零零散散的坑笔记也懒得往过搬了。</p>
<blockquote>
<h2 id="python2-对-range-的想法">python2： 对 <em>range</em> 的想法</h2>
</blockquote>
<ul>
<li>于 2016年12月15日16:26:12
<ul>
<li>
<p>一个小时前CTO大人（以下简称杰哥）过来找我说一个很奇怪的问题：同一个脚本检索两台数据库，一台国内一台国外，国外的没出问题，国内的时不时报错。
（讲道理我的第一反应是&hellip;觉得国外的服务器香一些。。。）</p>
</li>
<li>
<p>登到监控服务器 vi+ pdb 一顿调试，问题出在了神奇的地方：</p>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># python伪代码</span>

<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">file/to/path</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;</span>) <span style="color:#66d9ef">as</span> f:
    localfsize <span style="color:#f92672">=</span> getsize(f)
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, localfsize, <span style="color:#ae81ff">1</span>):
        f<span style="color:#f92672">.</span>seek(size<span style="color:#f92672">-</span>i)
        <span style="color:#75715e"># dosomething..,</span>
        <span style="color:#66d9ef">pass</span>
</code></pre></div><p>第一次运行 <code>for i in range</code> 就报出memeryError，很自然的想到是range.</p>
<p>因为python2 的range 返回的还是一个完整的数组， 而推荐使用的<code>xrange</code> 返回的是一个生成器，占用内存空间更小.</p>
<p>一开始我是拒绝的，因为之前一直都是懒的多写那个<code>x</code>,因为本屁民觉得在2016年的今天，一个多占了几mb内存的range并不可能发生内存溢出错误</p>
<p>像我们这种土豪公司，开发机都是4核8线程 64g内存，怎么可能运行个脚本会发生内存错误？</p>
<p>它真的发生了：</p>
<p>这个故事发生在一个十分尴尬的环境，杰哥把脚本跑在了他自己的开车服务器（aws大流量1g内存1核），
整个脚本的流程是开两个线程，分别从国内集群和国外集群的log_db上查询 &raquo; 增量追加到内部处理log。</p>
<p>一个本地日志文件大概是300mb-1g不等的样子。
没错，日志很大，,但又恰好都没有到造成内存溢出的程度，所以就愉快的继续运行了，到了<code>range</code> 这里，localfilesize刚好是一个千万级别的整形数字（假设为1kw），即使是按c的计算方法，不考虑堆栈大小，在内存重要占用空间为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 顺便说一句python 3.6 新功能:写长数字时可以在中间加下划线`_` ,方便阅读</span>
<span style="color:#ae81ff">4</span> <span style="color:#960050;background-color:#1e0010">×</span> <span style="color:#ae81ff">1000</span>_0000 <span style="color:#f92672">=</span> <span style="color:#ae81ff">4000</span>_0000B <span style="color:#f92672">=</span> <span style="color:#ae81ff">40000</span>KB <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>MB

</code></pre></div><p>同事脑补了触发memoryERROR 两种可能:1. 这个大数组挤爆了栈空间  | 2. 它成了挤爆内存的最后一根稻草</p>
<ul>
<li>于 2016年12月15日20:54:08</li>
</ul>
<p>上面的脑补不是很靠谱，刚才又做了一堆测试，发现了更多的问题。</p>
<ul>
<li>
<p>测试过程</p>
<ul>
<li>偷了台实验室的计算服务器 :D</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 测试range 占用内存函数</span>
<span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> getsizeof
foo1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x:getsizeof(range(int(<span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#f92672">*</span>x)))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 返回的数字与实际最高内存占用出入很大, 另开一个shell 监控memory</span>
watch -n 0.01  <span style="color:#e6db74">&#34;free -m&#34;</span>
</code></pre></div><p><img src="http://qiniu.heyuhua.com/2016-12-15%2021-42-21%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="辛苦的见证啊" title=" "></p>
<p><code>foo1(x)</code> 结果：</p>
<table>
<thead>
<tr>
<th align="center"><code>x</code>的值</th>
<th align="right">运行时最高占用</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">10</td>
<td align="right">&lsquo;memoryError&rsquo;</td>
</tr>
<tr>
<td align="center">9</td>
<td align="right">31138_mb</td>
</tr>
<tr>
<td align="center">8</td>
<td align="right">3111_mb</td>
</tr>
<tr>
<td align="center">7</td>
<td align="right">77mb</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>跟之前口算的理想大小40mb 没差, 可以接受</p>
</li>
<li>
<p>然后给foo1 做一些修改：</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> getsizeof
foo2 <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> x:getsizeof(range(<span style="color:#ae81ff">0</span>, int(<span style="color:#ae81ff">10</span><span style="color:#f92672">*</span><span style="color:#f92672">*</span>x), <span style="color:#ae81ff">1</span>))

</code></pre></div><p><code>foo2(x)</code> 结果：</p>
<table>
<thead>
<tr>
<th align="center"><code>x</code>的值</th>
<th align="right">运行时最高占用</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">10</td>
<td align="right">&lsquo;memoryError&rsquo;</td>
</tr>
<tr>
<td align="center">9</td>
<td align="right">31138_mb</td>
</tr>
<tr>
<td align="center">8</td>
<td align="right">3111_mb</td>
</tr>
<tr>
<td align="center">7</td>
<td align="right">235mb</td>
</tr>
</tbody>
</table>
<p>**比较两次 <code>foo(7)</code> 可怕的事情发生了， range 生成同一内容的两种调用方法会有两种内存占用。 **</p>
<blockquote>
<p>至于国外集群不出问题的原因， 国外服务器一天生产的log 比较少，所以文件也比较小。so &hellip;</p>
</blockquote>
<p>end.</p>
<blockquote>
<h2 id="为什么我的super报错">为什么我的super报错？</h2>
</blockquote>
<ul>
<li>于 2016年12月16日15:06:31</li>
</ul>
<ul>
<li>问题代码：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">A</span>:
    <span style="color:#66d9ef">def</span> __init__(self):
        <span style="color:#66d9ef">pass</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">B</span>(a):
    <span style="color:#66d9ef">def</span> __init__(self):
        super(B, self)<span style="color:#f92672">.</span>__init__()

c <span style="color:#f92672">=</span> B()
</code></pre></div><p>上述代码会报<code>TypeError: super() argument 1 must be type, not classobj</code>错误</p>
<ul>
<li>
<p>解决办法 <code>class A:</code> 旧的类型写法已经被弃用， 改用<code>class A(object)</code> 万事大吉</p>
<ul>
<li>刚才我在想，为什么我不会范这个错误? 因为我已经懒到了根本不会写class&hellip;
这就是我的<em>BOP</em> 编程思想： <strong>Bed Oriented Programming</strong></li>
</ul>
</li>
</ul>
<h2 id="二-搬运wtfpyhon项目--自评">二. 搬运wtfpyhon项目 + 自评</h2>
<blockquote>
<p>项目地址： <a href="https://github.com/satwikkansal/wtfpython">wtfpy</a>  该项目使用DO WHAT THE FUCK YOU WANT 开源协议。所以应该在不获取授权的情况下搬运应该是没什么事的。</p>
<p>python 2的wft尽量少写。</p>
</blockquote>
<ol>
<li>
<h3 id="字符编码">字符编码</h3>
</li>
</ol>
<pre><code class="language-Ipython" data-lang="Ipython">In [2]: 'value' == 'valuе'
Out[2]: False
</code></pre><p>坑比指数 ⭐️</p>
<p>虽然看起来很魔幻，但是现实生活中能打出两个e的几率其实感觉相当低。必经我特么连cyrillic 码是啥都不知道。。。</p>
<ol start="2">
<li>
<h3 id="缩进--py-version--3">缩进 | py-version &lt; 3</h3>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">square</span>(x):
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">    A simple function to calculate square of a number by addition.</span><span style="color:#e6db74">
</span><span style="color:#e6db74"></span><span style="color:#e6db74">    </span><span style="color:#e6db74">&#34;&#34;&#34;</span>
    sum_so_far <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> counter <span style="color:#f92672">in</span> range(x):
        sum_so_far <span style="color:#f92672">=</span> sum_so_far <span style="color:#f92672">+</span> x
  <span style="color:#66d9ef">return</span> sum_so_far
</code></pre></div><p>上面的代码会输出 10而不会输出想象的 100</p>
<p>坑比指数⭐️</p>
<p>这码在idea里甚至会报错。。。就算vim党一般在配置里也会显式区分tab与spcace的区别（1tab=4space or 2space）</p>
<p>原因：在python2 的解释器中，1tab = 8space，所以return语句进入了for循环。python3已修复。</p>
<ol start="3">
<li>
<h3 id="python的hash特性">python的hash特性</h3>
</li>
</ol>
<p>坑比指数⭐️⭐️</p>
<p>eg：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">some_dict <span style="color:#f92672">=</span> {}
some_dict[<span style="color:#ae81ff">5.5</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Ruby</span><span style="color:#e6db74">&#34;</span>
some_dict[<span style="color:#ae81ff">5.0</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">JavaScript</span><span style="color:#e6db74">&#34;</span>
some_dict[<span style="color:#ae81ff">5</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Python</span><span style="color:#e6db74">&#34;</span>
</code></pre></div><p>magic:</p>
<pre><code>some_dict[5.0] == some_dict[5] == &quot;python&quot;
</code></pre><blockquote>
<p>&ldquo;javascript&quot;终究会被python无情碾压  ;D</p>
</blockquote>
<p>python的 list 使用 下标的hash作为实际索引，同时使用hash的还有equal。</p>
<p>如果你希望 <code>5.0 == 5</code> 这个判断句在python中是成立的，就需要接受 hash(5.0) == hash(5)。</p>
<p>同时也应该能接受 javascript被python碾压的结果。</p>
<ol start="4">
<li>
<h3 id="生成器--for-x-in-y-if-z">生成器  for x in y if z</h3>
</li>
</ol>
<p>坑比指数⭐️⭐🌟</p>
<p>eg:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">array <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">15</span>]
g <span style="color:#f92672">=</span> (x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> array <span style="color:#66d9ef">if</span> array<span style="color:#f92672">.</span>count(x) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>)
array <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">22</span>]
</code></pre></div><p>Output:</p>
<pre><code>In [3]: print(list(g))
In [4]: 8
</code></pre><p>在generator语法中， in 后面的对象是在声明时被确定的，而 if 后面的语句则会在生成器被执行时才被确定。所以<code>point(list(g))</code>等价于：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">print</span>([x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">15</span>] <span style="color:#66d9ef">if</span> [<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">22</span>]<span style="color:#f92672">.</span>count(x) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>])
</code></pre></div><ol start="5">
<li>
<h3 id="dict迭代中编辑">dict迭代中编辑</h3>
</li>
</ol>
<p>坑比指数：⭐️🌟</p>
<p>就在看wftpython 前一天，还收到一个想学python的前端同事抱怨：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 为什么下面的语句会报错？！</span>
a <span style="color:#f92672">=</span> {<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">a</span><span style="color:#e6db74">&#39;</span>:<span style="color:#ae81ff">1</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>}
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> a<span style="color:#f92672">.</span>keys():
  a<span style="color:#f92672">.</span>pop(i)
</code></pre></div><p>哈哈哈哈这事就这么过去吧。（这个锅python是不能背的）</p>
<p>wtfpy中的eg：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">x <span style="color:#f92672">=</span> {<span style="color:#ae81ff">0</span>: None}

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> x:
    <span style="color:#66d9ef">del</span> x[i]
    x[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> None
    <span style="color:#66d9ef">print</span>(i)
</code></pre></div><p>output:</p>
<pre><code>0
1
2
3
4
5
6
7
</code></pre><p>tips：永远不曾要尝试在iter dict时尝试添加和修改key.</p>
<ol start="6">
<li>
<h3 id="list的迭代中编辑">List的迭代中编辑</h3>
<p>坑比指数⭐️🌟</p>
<p>eg:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">list_1 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
list_2 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
list_3 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
list_4 <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]

<span style="color:#66d9ef">for</span> idx, item <span style="color:#f92672">in</span> enumerate(list_1):
    <span style="color:#66d9ef">del</span> item

<span style="color:#66d9ef">for</span> idx, item <span style="color:#f92672">in</span> enumerate(list_2):
    list_2<span style="color:#f92672">.</span>remove(item)

<span style="color:#66d9ef">for</span> idx, item <span style="color:#f92672">in</span> enumerate(list_3[:]):
    list_3<span style="color:#f92672">.</span>remove(item)

<span style="color:#66d9ef">for</span> idx, item <span style="color:#f92672">in</span> enumerate(list_4):
    list_4<span style="color:#f92672">.</span>pop(idx)
</code></pre></div><p>output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> list_1
[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> list_2
[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>]
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> list_3
[]
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> list_4
[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>]
</code></pre></div></li>
</ol>
<p>逐个分析：</p>
<p>​	list_1 的 enumrate的迭代中, del item 只是删除了 list中对象的副本。所以并不会变。</p>
<p>​	list_2和list_4在遍历的第一步删除数字<code>1</code>后list的内容变成了<code>[2, 3, 4]</code> .这些剩余的元素下标会顺延，比如 2的下标会变成0， 3的变成1，所以，当第二次遍历时，index 为 1的元素3将会被删除。</p>
<ol start="7">
<li>
<h3 id="字符串联结">字符串联结</h3>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_string_with_plus</span>(iters):
    s <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(iters):
        s <span style="color:#f92672">+</span><span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">xyz</span><span style="color:#e6db74">&#34;</span>
    <span style="color:#66d9ef">assert</span> len(s) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>iters

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_string_with_format</span>(iters):
    fs <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">*</span>iters
    s <span style="color:#f92672">=</span> fs<span style="color:#f92672">.</span>format(<span style="color:#f92672">*</span>([<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">xyz</span><span style="color:#e6db74">&#34;</span>]<span style="color:#f92672">*</span>iters))
    <span style="color:#66d9ef">assert</span> len(s) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>iters

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_string_with_join</span>(iters):
    l <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(iters):
        l<span style="color:#f92672">.</span>append(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">xyz</span><span style="color:#e6db74">&#34;</span>)
    s <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(l)
    <span style="color:#66d9ef">assert</span> len(s) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>iters

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">convert_list_to_string</span>(l, iters):
    s <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>join(l)
    <span style="color:#66d9ef">assert</span> len(s) <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>iters
</code></pre></div><pre><code>&gt;&gt;&gt; timeit(add_string_with_plus(10000))
100 loops, best of 3: 9.73 ms per loop
&gt;&gt;&gt; timeit(add_string_with_format(10000))
100 loops, best of 3: 5.47 ms per loop
&gt;&gt;&gt; timeit(add_string_with_join(10000))
100 loops, best of 3: 10.1 ms per loop
&gt;&gt;&gt; l = [&quot;xyz&quot;]*10000
&gt;&gt;&gt; timeit(convert_list_to_string(l, 10000))
10000 loops, best of 3: 75.3 µs per loop
</code></pre><p>耗时天壤之别。但是坑比等级：⭐️</p>
<ul>
<li>
<p>大三找实习的时候就有hr叔叔问过我你喜欢用什么做字符串联结。本萌新立马说 用➕。然后那个面试没过。加号的慢是因为 python中的str为不可变对象。加法作为一个双目运算符，每次做一次字符串联结都要创建一次新str对象。当对多个string进行联结时，比如 ‘’aa‘’ +'&lsquo;bb'&lsquo;+&quot;cc&rdquo;, 会首先生成中间变量 ”aabb“,在由“aabb”+&quot;cc&rdquo; 得到随后的 “aabbcc”</p>
</li>
<li>
<p>python内置的字符串填充工具  <code>.format</code> 和 <code>%</code>在做长字符串处理时效率很高, 但是在处理短字符串时表现欠佳。</p>
</li>
<li>
<p>使用join是最好的选择，一次join只会创建一次对象，多目运算神清气爽。</p>
</li>
<li>
<p>再给join创建 字符串数组的时候 不要使用append，list的动态扩容内存开销极大。</p>
<p>​</p>
</li>
</ul>
<ol start="8">
<li>
<h3 id="字符串滞留">字符串滞留</h3>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">some_string</span><span style="color:#e6db74">&#34;</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> id(a)
<span style="color:#ae81ff">140420665652016</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> id(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">some</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">_</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">string</span><span style="color:#e6db74">&#34;</span>) <span style="color:#75715e"># Notice that both the ids are same.</span>
<span style="color:#ae81ff">140420665652016</span>
<span style="color:#75715e"># using &#34;+&#34;, three strings:</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> timeit<span style="color:#f92672">.</span>timeit(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">s1 = s1 + s2 + s3</span><span style="color:#e6db74">&#34;</span>, setup<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">s1 = </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> * 100000; s2 = </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> * 100000; s3 = </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> * 100000</span><span style="color:#e6db74">&#34;</span>, number<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
<span style="color:#ae81ff">0.25748300552368164</span>
<span style="color:#75715e"># using &#34;+=&#34;, three strings:</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> timeit<span style="color:#f92672">.</span>timeit(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">s1 += s2 + s3</span><span style="color:#e6db74">&#34;</span>, setup<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">s1 = </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> * 100000; s2 = </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> * 100000; s3 = </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> </span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74"> * 100000</span><span style="color:#e6db74">&#34;</span>, number<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
<span style="color:#ae81ff">0.012188911437988281</span>
</code></pre></div><p>坑比等级：⭐️</p>
<p>同样是没什么卵用的字符串机制。在进行多次重复三字符串联结时，使用 += 要比单纯的两个加号快很多。因为在使用+=时 等号右面的<code>s2+s3</code>对象并不会销毁。</p>
<ol start="9">
<li>
<h3 id="else的扭曲之处">else的扭曲之处</h3>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">does_exists_num</span>(l, to_find):
      <span style="color:#66d9ef">for</span> num <span style="color:#f92672">in</span> l:
          <span style="color:#66d9ef">if</span> num <span style="color:#f92672">==</span> to_find:
              <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Exists!</span><span style="color:#e6db74">&#34;</span>)
              <span style="color:#66d9ef">break</span>
      <span style="color:#66d9ef">else</span>:
          <span style="color:#66d9ef">print</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">Does not exist</span><span style="color:#e6db74">&#34;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> some_list <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>]
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> does_exists_num(some_list, <span style="color:#ae81ff">4</span>)
Exists<span style="color:#960050;background-color:#1e0010">!</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> does_exists_num(some_list, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
Does <span style="color:#f92672">not</span> exist
</code></pre></div><p>for-else会在for循环内无break发生后触发else.</p>
<p>同理 try-except-else 无脑三连在try中语句正确执行后才会触发else.</p>
<p>坑壁指数：⭐️</p>
<ol start="10">
<li>
<h3 id="是是非非is">是是非非——is</h3>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">256</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a <span style="color:#f92672">is</span> b
True

<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">257</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> b <span style="color:#f92672">=</span> <span style="color:#ae81ff">257</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a <span style="color:#f92672">is</span> b
False

<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">257</span>; b <span style="color:#f92672">=</span> <span style="color:#ae81ff">257</span>
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a <span style="color:#f92672">is</span> b
True
</code></pre></div><p>坑比指数：⭐️⭐️⭐️⭐️</p>
<p><code>is</code> 与  <code>==</code>  的区别在于, 前者比较的是操作数是否为同一对象，即检查操作数id， 后者考量的是对象的数值是否相等，比如说使用 hash。</p>
<p>这里的现象涉及到了python的实现，当python启动时，整型数字中 -5 到 256的所有数字都会以对象形式预分配到内存中。所以 当 a，b为256 时， 他们都是一个<code>256</code>对象的引用, <code>a is b</code>返回True。</p>
<p>而当创建一个 大于256的数字时，则会生成一个新的integer对象。那么第二段case返回False也就理所应当了。</p>
<p>最后的True则涉及到另一个python的实现。当在一行初始化赋值多个变量时，同一值只会被创建一次。<code>a = 257; b = 257</code>, <code>c, d= 257, 257 </code>这里 <code>a is b</code>,<code>c is d</code> 都会被判True。</p>
<ol start="11">
<li>
<h3 id="循环内的闭包">循环内的闭包</h3>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">funcs <span style="color:#f92672">=</span> []
results <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">7</span>):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">some_func</span>():
        <span style="color:#66d9ef">return</span> x
    funcs<span style="color:#f92672">.</span>append(some_func)
    results<span style="color:#f92672">.</span>append(some_func())

funcs_results <span style="color:#f92672">=</span> [func() <span style="color:#66d9ef">for</span> func <span style="color:#f92672">in</span> funcs]
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> results
[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>]
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> funcs_results
[<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">6</span>]

</code></pre></div><p>坑比指数：⭐️⭐️✨</p>
<p>定义在循环中的闭包 如果使用外部循环变量，闭包将会绑定该变量而不是变量值。所以在循环结束后调用闭包时，闭包内使用的循环变量是其遍历结束时的值。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">funcs <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">7</span>):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">some_func</span>(x<span style="color:#f92672">=</span>x):
        <span style="color:#66d9ef">return</span> x
    funcs<span style="color:#f92672">.</span>append(some_func)
</code></pre></div><p>这种局部函数的写法更加妥当。</p>
<ol start="12">
<li>##被调戏的自加##</li>
</ol>
<p>input:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
b <span style="color:#f92672">=</span> a
a <span style="color:#f92672">=</span> a <span style="color:#f92672">+</span> [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>]
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a
[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>]
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> b
[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
</code></pre></div><p>嗯，似乎是正常的。下面是核爆现场。</p>
<p>Input：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
b <span style="color:#f92672">=</span> a
a <span style="color:#f92672">+</span><span style="color:#f92672">=</span> [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>]
</code></pre></div><p>Output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> a
[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>]
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> b
[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>]
</code></pre></div><p>坑比指数 ⭐️⭐️⭐️✨</p>
<p><code>a = a + [5, 6, 7, 8]</code> 会生成一个新list赋值给a, 此时的b就成了旧的a对象的唯一引用。</p>
<p><code>a += [5, 6, 7, 8]</code> 会产生不同的结果是因为这里list的自加实现 使用了extend 直接在原list上添加新对象。 所以 这里a和b此时还是指向的同一个list。</p>
<ol start="13">
<li>
<h3 id="不可变对象被玩弄">不可变对象被玩弄###</h3>
</li>
</ol>
<p>同样是利用了上一条 list 的 自加实现。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> another_tuple <span style="color:#f92672">=</span> ([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>], [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>], [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>])
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> another_tuple[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span><span style="color:#f92672">=</span> [<span style="color:#ae81ff">99</span>, <span style="color:#ae81ff">999</span>]
<span style="color:#a6e22e">TypeError</span>: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">tuple</span><span style="color:#e6db74">&#39;</span> object does <span style="color:#f92672">not</span> support item assignment
<span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> another_tuple
([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>], [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>], [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">1000</span>, <span style="color:#ae81ff">99</span>, <span style="color:#ae81ff">999</span>])
</code></pre></div><p>坑比指数：⭐️⭐️⭐️⭐️</p>
<p>这个是连环坑。首先这个自加会被执行并赋值，同时还会报tuple不可变的错误。</p>
<p>我觉得这就是个大bug。。。</p>
<ol start="14">
<li>
<h4 id="消失的外部变量">消失的外部变量###</h4>
</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">e <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
<span style="color:#66d9ef">try</span>:
    <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">Exception</span>()
<span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">pass</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;</span><span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">print</span>(e)
<span style="color:#a6e22e">NameError</span>: name <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">e</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> defined
</code></pre></div><p>坑比指数：⭐️</p>
<p>虽然很奇葩。但是如果按照规范coding是不会犯这种错误的。</p>
<p>这个现象涉及到expect as 语法的实现逻辑，当离开except 上下文时，会有一个隐式的del 语句将e删除.</p>
<p>一个正常的except语句：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">except</span> E <span style="color:#66d9ef">as</span> N:
    foo
</code></pre></div><p>会被解析成酱：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">except</span> E <span style="color:#66d9ef">as</span> N:
    <span style="color:#66d9ef">try</span>:
        do_any_thing_you_like
    <span style="color:#66d9ef">finally</span>:
        <span style="color:#66d9ef">del</span> N
</code></pre></div><p>（挑着翻译看心情。插眼 2017.09.05， 第二次更新 2017.09.18）</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">标签</span><br/>
                    
  <a class="tag tag--primary tag--small" href="http://blog.heyuhua.com/tags/python/">python</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://blog.heyuhua.com/2016/12/vimium%E8%BF%9B%E9%98%B6%E5%B0%8F%E7%82%92/" data-tooltip="vimium进阶小炒">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://blog.heyuhua.com/2016/12/linux-shell-%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/" data-tooltip="linux shell 实用技巧">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 <a href="https://github.com/v1c77">v1c77</a><br><a href="http://beian.miit.gov.cn">粤ICP备19031392号</a>. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://blog.heyuhua.com/2016/12/vimium%E8%BF%9B%E9%98%B6%E5%B0%8F%E7%82%92/" data-tooltip="vimium进阶小炒">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">下一篇</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://blog.heyuhua.com/2016/12/linux-shell-%E5%AE%9E%E7%94%A8%E6%8A%80%E5%B7%A7/" data-tooltip="linux shell 实用技巧">
              
                  <span class="hide-xs hide-sm text-small icon-mr">上一篇</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
              <i class="fa fa-facebook-official"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://blog.heyuhua.com/2016/12/python-%E7%9A%84%E5%9D%91/">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="5">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fblog.heyuhua.com%2F2016%2F12%2Fpython-%25E7%259A%2584%25E5%259D%2591%2F">
          <i class="fa fa-facebook-official"></i><span>分享到 Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http%3A%2F%2Fblog.heyuhua.com%2F2016%2F12%2Fpython-%25E7%259A%2584%25E5%259D%2591%2F">
          <i class="fa fa-twitter"></i><span>分享到 Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http%3A%2F%2Fblog.heyuhua.com%2F2016%2F12%2Fpython-%25E7%259A%2584%25E5%259D%2591%2F">
          <i class="fa fa-google-plus"></i><span>分享到 Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/85d1ea47d48692ca0ade206fa656bd14?s=110" alt="作者的图片" />
    
    <h4 id="about-card-name">vici</h4>
    
      <div id="about-card-bio">极度选择困难. <strong>懒癌晚期</strong></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        software engineer
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        Shenzhen | Beijing | Shanghai
      </div>
    
  </div>
</div>

    

    
  
    <div id="cover" style="background-image:url('http://qiniu.heyuhua.com/India1.little.jpg!huge.webp');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="http://blog.heyuhua.com/js/script-pcw6v3xilnxydl1vddzazdverrnn9ctynvnxgwho987mfyqkuylcb1nlt.min.js"></script>


  
    <script src="http://qiniu.heyuhua.com/highlight.pack.js"></script>
  

<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'http:\/\/blog.heyuhua.com\/2016\/12\/python-%E7%9A%84%E5%9D%91\/';
          
            this.page.identifier = '\/2016\/12\/python-%E7%9A%84%E5%9D%91\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'vic1blog';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  




    
  </body>
</html>

